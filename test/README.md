# Тестовый раннер на Bash

Этот скрипт предназначен для автоматического запуска и проверки набора тестов, организованных в каталогах. Каждый тест представляет собой набор команд и ожидаемых результатов для сравнения.

---

## Особенности

- Поддержка предварительных (`run_before.txt`) и завершающих (`run_after.txt`) скриптов для подготовки и очистки окружения теста.
- Проверка вывода тестируемых команд с детальным сравнением с ожидаемым выводом (`expected.output.txt`).
- Проверка содержимого файлов, указанных в формате `expected.files.txt` с детальным выводом различий.
- Отчет о пройденных и проваленных тестах с цветным выводом (красный для ошибок, зеленый для успеха).
- Прерывание выполнения при первой ошибке (set -euo pipefail).

---

## Структура теста

Каждый тест размещается в отдельном подкаталоге и может содержать следующие файлы:

- `run.txt` — основная команда или скрипт, который нужно выполнить в рамках теста (обязателен).
- `run_before.txt` — скрипт, выполняемый перед запуском основной команды (необязателен).
- `run_after.txt` — скрипт, выполняемый после успешного прохождения теста (необязателен).
- `input.txt` — входные данные для команды из `run.txt` (необязателен).
- `expected.output.txt` — файл с ожидаемым выводом команды.
- `expected.files.txt` — файл с описанием ожидаемого содержимого файлов. Формат:
    ```
    <имя_файла>
    <содержимое_файла>
    ===EOF===
    ```
    Такой блок повторяется для каждого файла, который нужно проверить.

---

## Использование

```bash
./run_tests.sh <каталог_тестов>
```

где `<каталог_тестов>` — путь к каталогу, в котором расположены подкаталоги с тестами.

---

## Детали работы

- Скрипт последовательно запускает каждый подкаталог как отдельный тест.
- Для каждого теста запускается команда из `run.txt`, при необходимости с перенаправлением стандартного ввода из `input.txt`.
- Результат выполнения команды сравнивается с `expected.output.txt`. В случае несовпадения выводится цветной подробный diff с подписями "Ожидалось" и "Получено".
- Содержимое файлов, описанных в `expected.files.txt`, также сравнивается с реальными файлами.
- При успешном выполнении теста (без ошибок и расхождений) запускается `run_after.txt` при его наличии.
- По окончании выводится сводка по всем запущенным тестам.

---

## Цвета вывода

- Красный — ошибки и несоответствия.
- Зеленый — успешное выполнение.
- Желтый — предупреждения или пропущенные части теста.

---

## Требования

- Команды `diff`, `sed`, `mktemp`, `find`.

---

## Пример
```
tests/
    1_test/
        run.txt
        input.txt
        expected.output.txt
        expected.files.txt
        run_before.txt
        run_after.txt
    2_test/
        run.txt
        expected.output.txt
```
Запуск:
```bash
./tests/run.sh tests/cases
```
